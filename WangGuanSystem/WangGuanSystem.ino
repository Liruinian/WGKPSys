#include <U8glib.h>
#include <DS3231.h>
#include <Wire.h>
DS3231 Clock;

bool Century=false;
bool h12;
bool PM;
byte ADay, AHour, AMinute, ASecond, ABits;
bool ADy, A12h, Apm;
char output;

//byte year, month, date, DoW, hour, minute, second;
int second,minute,hour,date,month,year,temperature; 
void ReadDS3231()
{
  second=Clock.getSecond();
  minute=Clock.getMinute();
  hour=Clock.getHour(h12, PM);
  date=Clock.getDate();
  month=Clock.getMonth(Century);
  year=Clock.getYear();
  
  temperature=Clock.getTemperature();
  //sprintf(output, "20%d-%d-%d %d:%d:%d Temp=%d",year, month, date,hour,minute,second,temperature);  
  //Serial.print("output="+output);
    Serial.print("20");
  Serial.print(year,DEC);
  Serial.print('-');
  Serial.print(month,DEC);
  Serial.print('-');
  Serial.print(date,DEC);
  Serial.print(' ');
  Serial.print(hour,DEC);
  Serial.print(':');
  Serial.print(minute,DEC);
  Serial.print(':');
  Serial.print(second,DEC);
  Serial.print('\n');
  Serial.print("Temperature=");
  Serial.print(temperature); 
  Serial.print('\n');
}
static const unsigned char PROGMEM w[] ={0x00,0x00,0x7F,0xFC,0x40,0x04,0x40,0x04,0x42,0x14,0x52,0x94,0x4A,0x54,0x44,0x24,0x44,0x24,0x4A,0x54,0x4A,0x54,0x52,0x94,0x61,0x04,0x40,0x04,0x40,0x14,0x40,0x08};/*"网",0*/
static const unsigned char PROGMEM g[] ={0x20,0x40,0x3F,0x7E,0x48,0x90,0x85,0x08,0x01,0x00,0x7F,0xFE,0x40,0x02,0x9F,0xE4,0x10,0x20,0x1F,0xE0,0x10,0x00,0x1F,0xF0,0x10,0x10,0x10,0x10,0x1F,0xF0,0x10,0x10};/*"管",1*/
static const unsigned char PROGMEM k[] ={0x20,0x00,0x21,0xFC,0x7D,0x04,0x45,0x04,0x89,0xFC,0x7D,0x04,0x55,0x04,0x55,0xFC,0x7C,0x00,0x55,0x12,0x55,0xD4,0x7D,0x18,0x01,0x10,0x1D,0x52,0xE1,0x92,0x41,0x0E};/*"鲲",2*/
static const unsigned char PROGMEM p[] ={0x00,0x10,0x77,0x20,0x55,0x7C,0x55,0x44,0x55,0x64,0x77,0x54,0x55,0x44,0x55,0x4C,0x55,0x40,0x77,0x7E,0x55,0x02,0x55,0x02,0x55,0x7A,0xB5,0x02,0x89,0x0A,0x13,0x04};/*"鹏",3*/
static const unsigned char PROGMEM q[] ={0x01,0x00,0x21,0x08,0x21,0x08,0x3F,0xF8,0x00,0x20,0x22,0x20,0x22,0x3E,0xFF,0x42,0x22,0x94,0x22,0x10,0x3E,0x10,0x22,0x10,0x22,0x28,0x3E,0x28,0x22,0x44,0x00,0x82};/*"嵌",4*/
static const unsigned char PROGMEM r[] ={0x04,0x00,0x02,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x02,0x80,0x02,0x80,0x02,0x80,0x04,0x40,0x04,0x40,0x08,0x20,0x08,0x20,0x10,0x10,0x20,0x10,0x40,0x08,0x80,0x06};/*"入",5*/
static const unsigned char PROGMEM s[] ={0x00,0x48,0x00,0x44,0x00,0x44,0x00,0x40,0xFF,0xFE,0x00,0x40,0x00,0x40,0x3E,0x40,0x08,0x40,0x08,0x40,0x08,0x20,0x08,0x22,0x0F,0x12,0x78,0x0A,0x20,0x06,0x00,0x02};/*"式",6*/
static const unsigned char PROGMEM x[] ={0x00,0xF8,0x3F,0x00,0x04,0x00,0x08,0x20,0x10,0x40,0x3F,0x80,0x01,0x00,0x06,0x10,0x18,0x08,0x7F,0xFC,0x01,0x04,0x09,0x20,0x11,0x10,0x21,0x08,0x45,0x04,0x02,0x00};/*"系",7*/
static const unsigned char PROGMEM t[] ={0x10,0x40,0x10,0x20,0x20,0x20,0x23,0xFE,0x48,0x40,0xF8,0x88,0x11,0x04,0x23,0xFE,0x40,0x92,0xF8,0x90,0x40,0x90,0x00,0x90,0x19,0x12,0xE1,0x12,0x42,0x0E,0x04,0x00};/*"统",8*/

static const unsigned char PROGMEM wen[] ={0x0F,0x80,0x88,0x80,0x4F,0x80,0x08,0x80,0x0F,0x80,0x80,0x00,0x5F,0xC0,0x15,0x40,0x35,0x40,0x55,0x40,0x95,0x40,0x3F,0xE0};/*"温",0*/
static const unsigned char PROGMEM du[] ={0x02,0x00,0x7F,0xE0,0x48,0x80,0x7F,0xE0,0x48,0x80,0x4F,0x80,0x40,0x00,0x5F,0xC0,0x48,0x40,0x44,0x80,0x43,0x00,0x9C,0xE0};/*"度",1*/
#include "U8glib.h"
U8GLIB_SSD1306_128X64 u8g(U8G_I2C_OPT_NONE|U8G_I2C_OPT_DEV_0);	// I2C / TWI 

void draw(void) {
  u8g.drawBitmapP(0+5,0+5,2,16,w);
  u8g.drawBitmapP(16+5,0+5,2,16,g);
  u8g.drawBitmapP(32+5,0+5,2,16,k);
  u8g.drawBitmapP(48+5,0+5,2,16,p);
  u8g.drawBitmapP(64+5,0+5,2,16,x);
  u8g.drawBitmapP(80+5,0+5,2,16,t);
//  u8g.drawBitmapP(0+5,16+5+5,2,16,q);
//  u8g.drawBitmapP(16,16+5+5,2,16,r);
//  u8g.drawBitmapP(32,16+5+5,2,16,s);
//  u8g.drawBitmapP(48,16+5+5,2,16,x);
//  u8g.drawBitmapP(64,16+5+5,2,16,t);
  u8g.setFont(u8g_font_6x12);
  u8g.setPrintPos(102, 16); 
  u8g.print("v0.1");
  u8g.setPrintPos(5, 30); 
  u8g.print("20");
  u8g.print(year,DEC);
  u8g.print('-');
  u8g.print(month,DEC);
  u8g.print('-');
  u8g.print(date,DEC);
  u8g.print(' ');
  u8g.print(hour,DEC);
  u8g.print(':');
  u8g.print(minute,DEC);
  u8g.print(':');
  u8g.print(second,DEC);
  u8g.drawBitmapP(5,32,2,12,wen);
  u8g.drawBitmapP(17,32,2,12,du);
  u8g.setPrintPos(30, 41); 
  u8g.print(temperature); 
  u8g.setFont(u8g_font_6x10);
  u8g.drawStr(5, 55, "2020.10.01-04");
  u8g.drawFrame(0,0,128,64);
}

void setup(void) {
  // flip screen, if required
  // u8g.setRot180();
  Wire.begin();
  Serial.begin(115200);
}

void loop(void) {
  // picture loop
  u8g.firstPage();  
  do {
    draw();
  } while( u8g.nextPage() );
  ReadDS3231();
  // rebuild the picture after some delay
  delay(500);
}
